<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:pageModels="clr-namespace:WellnessWingman.PageModels"
             x:Class="WellnessWingman.Pages.PhotoReviewPage"
             x:DataType="pageModels:PhotoReviewPageViewModel"
             Title="Review Photo">
    <ScrollView>
        <VerticalStackLayout Spacing="20" Padding="24">
            <Image Source="{Binding PreviewImage}"
                   Aspect="AspectFit"
                   HeightRequest="260"
                   SemanticProperties.Description="Captured photo preview" />

            <Label Text="{Binding CaptureInfo}"
                   Style="{StaticResource Caption1}" />

            <Label Text="Add context to help the AI (optional)"
                   Style="{StaticResource Body2Strong}" />

            <!-- Voice Recording Button -->
            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12" Margin="0,0,0,8">
                <Label Grid.Column="0"
                       Text="{Binding RecordingButtonText}"
                       VerticalOptions="Center"
                       Style="{StaticResource Caption1}"
                       TextColor="{StaticResource Gray600}" />
                <Button Grid.Column="1"
                        Text="{Binding RecordingButtonIcon}"
                        FontSize="24"
                        WidthRequest="56"
                        HeightRequest="56"
                        CornerRadius="28"
                        BackgroundColor="{Binding RecordingButtonColor}"
                        TextColor="White"
                        Command="{Binding ToggleRecordingCommand}"
                        IsEnabled="{Binding IsRecordingButtonEnabled}"
                        SemanticProperties.Description="{Binding RecordingButtonText}" />
            </Grid>

            <!-- Recording Status Indicator -->
            <StackLayout Orientation="Horizontal"
                         Spacing="8"
                         IsVisible="{Binding IsRecording}"
                         HorizontalOptions="Center"
                         Margin="0,0,0,8">
                <Ellipse Fill="Red"
                         WidthRequest="12"
                         HeightRequest="12"
                         VerticalOptions="Center" />
                <Label Text="{Binding RecordingDuration, StringFormat='Recording... {0:mm\\:ss}'}"
                       Style="{StaticResource Body2}"
                       TextColor="Red"
                       VerticalOptions="Center" />
            </StackLayout>

            <!-- Transcription Status -->
            <ActivityIndicator IsRunning="{Binding IsTranscribing}"
                               IsVisible="{Binding IsTranscribing}"
                               Color="{StaticResource Primary}" />
            <Label Text="Transcribing..."
                   IsVisible="{Binding IsTranscribing}"
                   Style="{StaticResource Caption1}"
                   HorizontalOptions="Center"
                   Margin="0,0,0,8" />

            <Editor Text="{Binding Description}"
                    Placeholder="E.g., &quot;I didn't eat the chips&quot;, portion sizes, ingredients... (or hold mic button to record)"
                    AutoSize="TextChanges"
                    MaximumHeightRequest="200"
                    IsEnabled="{Binding IsSubmitting, Converter={StaticResource InvertedBoolConverter}}"
                    SemanticProperties.Description="Optional context to help AI analysis" />

            <ActivityIndicator IsRunning="{Binding IsSubmitting}"
                               IsVisible="{Binding IsSubmitting}" />

            <Button Text="Save Entry"
                    Command="{Binding SubmitCommand}"
                    IsEnabled="{Binding IsSubmitting, Converter={StaticResource InvertedBoolConverter}}"
                    SemanticProperties.Description="Save entry with optional description" />

            <Button Text="Cancel"
                    Command="{Binding CancelCommand}"
                    IsEnabled="{Binding IsSubmitting, Converter={StaticResource InvertedBoolConverter}}"
                    SemanticProperties.Description="Cancel and discard photo"
                    BackgroundColor="{StaticResource Gray200}" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
