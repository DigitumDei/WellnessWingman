<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:pageModels="clr-namespace:HealthHelper.PageModels"
             x:Class="HealthHelper.Pages.MealDetailPage"
             x:DataType="pageModels:MealDetailViewModel"
             Title="Meal Details">
    <ScrollView>
        <VerticalStackLayout Spacing="16" Padding="24">
            <Image Source="{Binding Meal.FullPath}"
                   Aspect="AspectFit"
                   HeightRequest="300"
                   SemanticProperties.Description="Meal photo" />

            <Label Text="{Binding Meal.Description}" Style="{StaticResource Headline}" />
            <Label Text="{Binding Meal.LocalCapturedAt, StringFormat='Captured {0:MMM d, h:mm tt}'}" Style="{StaticResource Caption1}" />

            <Label Text="Analysis" Style="{StaticResource Title2}" Margin="0,16,0,0" />
            <Label Text="{Binding AnalysisText}" Style="{StaticResource Body1}" />

            <Button Text="{Binding CorrectionToggleButtonText}"
                    Command="{Binding ToggleCorrectionCommand}"
                    Margin="0,16,0,0" />

            <Border IsVisible="{Binding IsCorrectionMode}"
                    Padding="16">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="12">
                    <Label Text="Add any details we missed so the analysis can be corrected."
                           Style="{StaticResource Caption1}" />
                    <Editor Text="{Binding CorrectionText}"
                            Placeholder="Describe what's actually in the meal or what needs to change."
                            AutoSize="TextChanges"
                            MinimumHeightRequest="120" />
                    <ActivityIndicator IsVisible="{Binding IsSubmittingCorrection}"
                                       IsRunning="{Binding IsSubmittingCorrection}"
                                       HorizontalOptions="Start" />
                    <Button Text="Send correction"
                            Command="{Binding SubmitCorrectionCommand}" />
                </VerticalStackLayout>
            </Border>

            <Button Text="Delete"
                    Command="{Binding DeleteCommand}"
                    BackgroundColor="{StaticResource Error}"
                    TextColor="{StaticResource OnError}"
                    Margin="0,16,0,0" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
