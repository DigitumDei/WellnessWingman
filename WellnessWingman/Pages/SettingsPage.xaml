<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:WellnessWingman.Models"
             xmlns:viewmodels="clr-namespace:WellnessWingman.PageModels"
             xmlns:f="clr-namespace:Fonts;assembly=WellnessWingman"
             x:Class="WellnessWingman.Pages.SettingsPage"
             x:DataType="viewmodels:SettingsViewModel"
             Title="Settings">
    <VerticalStackLayout Spacing="20" Padding="20">
        <Label Text="LLM Provider"
               AutomationProperties.Name="LlmProviderLabel" />
        <Picker ItemsSource="{Binding Providers}"
                SelectedItem="{Binding SelectedProvider}"
                AutomationProperties.Name="LlmProviderPicker" />

        <Label Text="API Key"
               AutomationProperties.Name="ApiKeyLabel" />
        <Grid ColumnDefinitions="*,40" VerticalOptions="Center">
            <Entry
                Grid.Column="0"
                Text="{Binding ApiKey}"
                IsPassword="{Binding IsApiKeyMasked}"
                Placeholder="Paste your provider key"
                VerticalOptions="Center"
                AutomationProperties.Name="ApiKeyEntry" />
            <ImageButton
                Grid.Column="1"
                Command="{Binding ToggleApiKeyVisibilityCommand}"
                BackgroundColor="Transparent"
                WidthRequest="40"
                HeightRequest="40"
                Padding="6"
                SemanticProperties.Description="Toggle API key visibility"
                AutomationProperties.Name="ToggleApiKeyVisibilityButton">
                <ImageButton.Source>
                    <FontImageSource
                        Glyph="{Binding ToggleIconGlyph}"
                        FontFamily="{x:Static f:FluentUI.FontFamily}"
                        Color="{AppThemeBinding Light={StaticResource DarkOnLightBackground}, Dark={StaticResource LightOnDarkBackground}}" />
                </ImageButton.Source>
            </ImageButton>
        </Grid>

        <Label Text="Model"
               AutomationProperties.Name="ModelLabel" />
        <Entry Text="{Binding ModelId}"
               Placeholder="e.g. gpt-5-mini"
               AutomationProperties.Name="ModelEntry" />

        <Button Text="Save"
                Command="{Binding SaveSettingsCommand}"
                AutomationProperties.Name="SaveSettingsButton" />

        <BoxView HeightRequest="1" Color="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray500}}" Margin="0,10" />
        
        <Label Text="Data Management" FontAttributes="Bold" />
        
        <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
            <Button Grid.Column="0" 
                    Text="Export Data"
                    Command="{Binding ExportDataCommand}"
                    AutomationProperties.Name="ExportDataButton" />
            <Button Grid.Column="1" 
                    Text="Import Data"
                    Command="{Binding ImportDataCommand}"
                    AutomationProperties.Name="ImportDataButton" />
        </Grid>

        <Button Text="Share Diagnostics Log"
                Command="{Binding ShareDiagnosticsLogCommand}"
                AutomationProperties.Name="ShareDiagnosticsButton" />
    </VerticalStackLayout>
</ContentPage>
